# 图灵测试微信小程序项目解读文档

## 项目概述

这是一个基于图灵测试主题的微信小程序，用户通过听取音频对话来判断对话中的角色是人类还是AI。小程序具有用户系统、积分等级、成就系统、邀请机制等功能，旨在提供简约、有趣且具有社交性的用户体验。

### 基本信息
- **AppID**: `wx0aa6c0af7848b725`
- **云环境ID**: `cloud1-8gbjshfgf7c95b79`
- **技术栈**: 微信小程序原生开发 + 腾讯云开发
- **支持语言**: 中文/英文双语
- **设计风格**: 卡通平面插画风格 + 拟物3D图标 + 极简主义美学

---

## 项目架构

### 1. 目录结构

```
miniprogram/                    # 小程序前端代码
├── pages/                     # 主包页面
│   ├── welcome/              # 欢迎页（入口页）
│   ├── user-info/            # 用户信息收集页
│   ├── game-home/            # 游戏首页（Tab页）
│   ├── campus/               # 校园页（Tab页）
│   ├── profile/              # 个人中心（Tab页）
│   ├── quick-intro/          # 快速挑战介绍页
│   └── edit-profile/         # 编辑资料页
├── subpackages/              # 分包
│   ├── conversation/         # 对话游戏核心页面
│   └── summary/              # 游戏结果总结页
├── utils/                    # 工具类
│   ├── basePage.js          # 页面基类（国际化支持）
│   ├── i18n.js              # 国际化配置
│   └── stringUtils.js       # 字符串工具
├── assets/                   # 静态资源
│   ├── images/              # 图片资源（按页面分类），存放svg格式矢量图
│   ├── figma/               # Figma设计图，存放png格式图片
│   └── iconfont/            # 图标字体
├── app.js                   # 全局应用逻辑
├── app.json                 # 应用配置
└── app.wxss                 # 全局样式

cloudfunctions/               # 云函数
├── login/                   # 用户登录云函数
├── handleInvite/            # 邀请码处理云函数
└── cleanDuplicateStats/     # 数据清理合并云函数
```

### 2. 技术架构

#### 前端架构
- **页面管理**: 基于 `basePage.js` 的统一页面基类
- **国际化**: 完整的中英文双语支持
- **状态管理**: 全局 `app.globalData` 状态管理
- **音频处理**: 基于微信 `InnerAudioContext` API

#### 后端架构
- **云开发**: 腾讯云开发平台
- **数据库**: 云数据库（NoSQL）
- **存储**: 云存储（音频文件）
- **云函数**: 用户登录、邀请处理等核心逻辑

### 3. 设计系统

#### 设计风格
- **视觉风格**: 卡通平面插画风格，营造友好亲和的氛围
- **图标系统**: 拟物3D图标设计，增强视觉层次感
- **设计理念**: 极简主义美学，去除冗余元素
- **空间设计**: 恰到好处的留白，提升阅读体验

#### 色彩系统
- **主色调**: 清新柔和的渐变配色
- **品牌色**: 与整体设计风格浑然一体
- **功能色**: 明确的状态指示色彩（成功、警告、错误）
- **中性色**: 优雅的灰度层级

#### 布局原则
- **模块化卡片**: 信息以卡片形式组织，层次清晰
- **微妙阴影**: 通过细腻的阴影过渡营造空间感
- **视觉聚焦**: 用户视线能自然聚焦核心功能
- **响应式**: 适配不同屏幕尺寸的舒适视觉比例

#### 交互设计
- **轻盈通透**: 沉浸式体验，减少界面干扰
- **微交互**: 精心打磨的动画细节
- **反馈机制**: 清晰的操作反馈和状态提示
- **游戏化**: 融入适度的游戏炫酷元素

---

## 核心功能详解

### 1. 用户系统

#### 用户注册流程
1. **欢迎页** (`welcome`) - 语言选择，开始挑战
2. **信息收集** (`user-info`) - 收集年龄、性别、学历、AI熟悉度
3. **邀请码处理** - 可选填写邀请码，若填写则邀请人获得额外奖励

#### 用户数据结构
```javascript
{
  _openid: "用户唯一标识",
  nickname: "用户昵称",
  age: "年龄段",
  gender: "性别",
  education: "学历",
  aiFamiliarity: "AI工具熟悉度",
  avatarUrl: "头像URL",
  inviteCode: "用户专属邀请码",
  invitedUsers: ["被邀请用户openid数组"],
  inviterID: "邀请者openid",
  claimCount: "邀请奖励领取次数",
  gameData: {}, // 游戏数据
  createTime: "创建时间",
  updateTime: "更新时间"
}
```

### 2. 游戏核心逻辑

#### 对话数据结构
对话音频按语言和身份组织：
- **路径结构**: `Audio/{lang}/{identity}/{lang}_test_{identity}.json`，存储在云存储
- **对话类型**: 
  - `HH`: 人类-人类对话
  - `HM`: 人类-AI对话  
  - `MH`: AI-人类对话
  - `MM`: AI-AI对话

#### 游戏流程
1. **快速挑战介绍** (`quick-intro`) - 规则说明
2. **对话判断** (`conversation`) - 核心游戏逻辑
   - 随机选择5段对话音频
   - 用户判断回应者B是否为AI
   - 实时计分和连击系统
   - 每题作答后简要分析和重听
3. **结果总结** (`summary`) - 成绩分析和成就系统

#### 评分系统
- **基础得分**: 正确+1分，错误-1分（不低于0）
- **连击奖励**: 连续3次正确开始，每两次递增1分
  - 3-4连击: +2分
  - 5-6连击: +3分
  - 7-8连击: +4分（以此类推）
- **跨轮次连击**: 连击可跨多轮游戏累积，但若用户中途退出挑战，则连击停止

#### 等级系统
```javascript
// 等级定义
const levels = {
  newUser: '图灵萌新',        // 0-99分
  amateurExplorer: '业余探索者',  // 100-199分
  seniorIdentifier: '资深鉴别师', // 200-299分
  turingMaster: '图灵大师',      // 300-499分
  superIdentifier: '超级鉴别者'   // 500分以上
}
```

### 3. 成就系统

内置4种成就类型：
- **初次尝试**: 完成第一轮图灵挑战
- **完美判断**: 在一轮挑战中获得100%正确率
- **连击大师**: 全局连击达到10次
- **完美连胜**: 连击达到15次

### 4. 邀请系统

#### 邀请机制
- 每位用户最多邀请5位好友
- 邀请成功获得递增金币奖励：30、40、50、60、70
- 通过6位字母数字邀请码分享
- 填写次数超过5次后，邀请码自动失效

#### 云函数实现
- **validateCode**: 验证邀请码有效性
- **processInvite**: 处理邀请关系建立

### 5. 校园功能

校园页面包含多种互动功能：
- **邀请好友**: 生成邀请码和奖励领取
- **签到打卡**: 日常签到（开发中）
- **大转盘**: 幸运抽奖（开发中）
- **打卡好礼**: 连续打卡奖励（开发中）

---

## 页面功能详解

### 1. 欢迎页 (`welcome`)
- **功能**: 应用入口，语言切换，开始游戏
- **特色**: 动画效果，语言本地化
- **逻辑**: 检测用户注册状态，引导至对应页面
- **设计特点**: 
  - 卡通机器人形象作为品牌IP
  - 语言切换采用toggle按钮左右切换


### 2. 游戏首页 (`game-home`)
- **功能**: 主导航页面，展示用户状态和游戏模式
- **包含内容**:
  - 用户信息卡片（头像、昵称、等级、积分）
  - 挑战模式选择（快速挑战、困难模式）
  - 语音克隆模式（开发中）
  - 排行榜预览（前10名）
- **技术特点**: 实时数据同步，等级进度可视化
- **设计特点**:
  - 模块化卡片布局，信息层级清晰
  - 挑战模式卡片使用SVG插画风格
  - 排行榜采用不规则卡通排行榜
  - 金币和积分数字使用醒目的字体样式

### 3. 对话页面 (`conversation`)
- **核心功能**: 游戏主体逻辑
- **音频处理**: 
  - 云存储音频下载和缓存
  - 进度条控制和拖拽跳转
  - 预加载下一题音频
- **界面交互**:
  - 对话展开/收起
  - 判断按钮（B是人类/B是AI）
  - 实时得分和连击显示
- **数据处理**: 
  - 防重复播放策略
  - 退出确认和数据保护


### 4. 结果总结页 (`summary`)
- **功能**: 游戏结果展示和分析
- **包含内容**:
  - 本轮成绩统计（正确率、得分、连击）
  - 等级进度和升级提醒
  - 成就解锁动画
  - 个性化分析报告
  - 金币奖励
- **交互**: 分享成绩、再来一轮
- **设计特点**:
  - 卡通机器人根据成绩显示不同表情
  - 成就解锁采用弹窗动画效果

### 5. 校园页面 (`campus`)
- **功能**: 社交和任务中心
- **邀请系统**: 
  - 邀请码生成和分享
  - 邀请进度追踪
  - 奖励领取机制
- **任务模块**: 签到、抽奖等（部分开发中）
- **设计特点**:
  - 顶部横幅采用插画风格背景
  - 任务卡片使用不同主题色彩区分
  - 邀请机器人形象生动可爱
  - 进度条使用彩色渐变设计


### 6. 个人中心 (`profile`)
- **功能**: 用户数据展示和设置
- **包含内容**:
  - 个人统计（正确率、最大连击、排名）
  - 成就展示
  - 历史记录
  - 设置（语言、主题、反馈）
- **设计特点**:
  - 成就徽章使用精美的SVG图标
  - 统计数据采用环形进度条可视化
  - Tab切换使用流畅的过渡动画
  - 设置项采用简洁的列表布局

---

## 数据流架构

### 1. 数据库设计

#### 主要集合
- **users**: 用户基础信息和游戏数据
- **dialogueStats**: 对话统计数据（全局）
- **feedback**: 用户反馈

#### 数据同步策略
- **本地优先**: 使用 `app.globalData` 本地状态
- **云端同步**: 关键时刻同步到云数据库
- **离线兼容**: 支持离线游戏，恢复后同步

### 2. 音频资源管理

#### 存储结构
```
Audio/
├── zh/                    # 中文音频
│   ├── HH/               # 人类-人类对话
│   ├── HM/               # 人类-AI对话
│   ├── MH/               # AI-人类对话
│   └── MM/               # AI-AI对话
└── en/                   # 英文音频
    └── [同上结构]
```

#### 音频处理策略
- **预加载**: 提前下载下一题音频
- **本地缓存**: 避免重复下载
- **内存管理**: 及时清理不用的音频文件

### 3. 国际化实现

#### 多语言支持
- **配置文件**: `utils/i18n.js` 集中管理所有文本
- **动态切换**: 实时切换语言无需重启
- **资源适配**: 图片、音频按语言分类存储
- **页面基类**: `basePage.js` 统一处理语言切换

---

## 核心技术实现

### 1. 页面基类系统

`basePage.js` 提供统一的页面功能：
- 国际化文本管理
- 语言切换监听
- 标准分享功能
- 导航栏动态更新

### 2. 音频播放器

基于微信 `InnerAudioContext` 实现：
- 播放状态管理
- 进度条同步
- 错误处理和重试
- 后台播放控制

### 3. 连击系统

跨页面连击数管理：
- 全局状态保持
- 云端同步确保数据一致性
- 中途退出重置机制

### 4. 成就系统

动态成就检测和展示：
- 实时检测成就达成条件
- 链式弹窗展示多个成就
- 本地存储和云端同步

---

## 开发规范和最佳实践

### 1. 代码结构
- **模块化**: 功能按页面和工具类分离
- **复用性**: 公共逻辑抽取到基类和工具函数
- **可维护性**: 清晰的命名和注释

### 2. 性能优化
- **分包加载**: 核心游戏功能独立分包
- **图片优化**: SVG图标，WebP格式支持
- **音频缓存**: 智能预加载和内存管理
- **数据懒加载**: 按需加载用户数据
- **设计优化**: 
  - SVG矢量图标确保高分辨率显示
  - 渐变色和阴影使用CSS3实现，减少图片使用
  - 卡片布局采用flexbox优化性能
  - 动画使用transform属性避免重排

### 3. 用户体验
- **加载状态**: 全面的loading状态管理
- **错误处理**: 友好的错误提示和重试机制
- **离线支持**: 基本功能支持离线使用
- **响应式**: 适配不同屏幕尺寸
- **视觉体验**:
  - 卡通插画风格营造轻松愉悦氛围
  - 3D拟物图标增强交互反馈
  - 极简布局减少认知负担
  - 微妙阴影营造空间层次感
  - 模块化卡片提高信息可读性

### 4. 数据安全
- **openid验证**: 所有用户操作基于openid验证
- **数据校验**: 前后端双重数据校验
- **防刷机制**: 连击和得分防作弊措施

---

## 部署和维护

### 1. 发布流程
1. 代码提交和审查
2. 云函数部署
3. 小程序版本上传
4. 审核和发布

### 2. 监控和维护
- **用户数据**: 定期备份和清理
- **音频资源**: 云存储空间管理
- **性能监控**: 页面加载时间和错误率
- **用户反馈**: 内置反馈系统收集问题

### 3. 扩展性
- **新功能**: 模块化设计便于添加新功能
- **多语言**: 易于添加更多语言支持
- **游戏模式**: 可扩展更多游戏类型和难度

---

## 注意事项

### 1. 微信小程序限制
- 包大小限制（主包2MB，分包2MB）
- 音频播放能力限制
- 云函数调用频率限制

### 2. 用户隐私
- 最小化数据收集
- 明确隐私政策
- 数据安全存储

---
