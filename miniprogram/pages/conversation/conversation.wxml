<view class="container">
  <!-- 顶部导航 -->
  <t-navbar 
    title="{{pageReady ? (t.dialogueTitle + ' ' + currentDialogue + '/' + totalDialogues) : t.loading}}"
    left-arrow="{{false}}"
    title-color="#1F2937"
    t-class="t-navbar"
    fixed
    placeholder
  >
    <view slot="left" class="custom-back-btn" bindtap="goBack">
      <t-icon name="chevron-left" size="48rpx" color="#1F2937" />
    </view>
  </t-navbar>
  
  <!-- 进度条 -->
  <view class="mb-large">
    <view class="flex-between text-gray mb-small">
      <text>{{t.progress}}</text>
      <text>{{currentDialogue}}/{{totalDialogues}}</text>
    </view>
    <view class="progress-bar">
      <view class="progress-bar-fill" style="width: {{(currentDialogue/totalDialogues)*100 + '%'}}"></view>
    </view>
  </view>
  
  <!-- 对话内容 -->
  <view class="card dialogue-card mb-medium">
    <block wx:for="{{displayMessages}}" wx:key="index">
      <view class="{{item.role === 'A' ? 'message-row' : 'message-row-reverse'}}">
        <view class="avatar-container {{item.role === 'A' ? 'avatar-a' : 'avatar-b'}}">
          <text>{{item.role}}</text>
        </view>
        <view class="message-bubble {{item.role === 'A' ? 'message-bubble-a' : 'message-bubble-b'}}">
          <text>{{item.content}}</text>
        </view>
      </view>
    </block>
    <!-- 展开/折叠按钮 -->
    <view wx:if="{{messages.length > maxLines}}" class="expand-button" bindtap="toggleExpand">
      <text>{{isExpanded ? t.collapse : t.expand}}</text>
      <t-icon name="{{isExpanded ? 'chevron-up' : 'chevron-down'}}" size="32rpx" color="#6B7280" />
    </view>
  </view>
  
  <!-- 播放控制 -->
  <view class="play-button-container mb-large">
    <view class="play-button {{audioLoading ? 'loading' : ''}}" bindtap="playAudio" bindtouchstart="onPlayButtonPress" bindtouchend="onPlayButtonRelease" bindtouchcancel="onPlayButtonRelease" style="transform: scale({{isPressed ? 0.9 : 1}}); transition: transform 0.1s;">
      <block wx:if="{{audioLoading}}">
        <view class="loading-icon"></view>
      </block>
      <block wx:else>
      <t-icon name="{{isPlaying ? 'pause' : 'play'}}" size="80rpx" color="#FFF" />
      </block>
    </view>
  </view>
  
  <!-- 提示文本 -->
  <view class="hint-text mb-large">
    {{t.hintText}}
  </view>
  
  <!-- 判断按钮 -->
  <view class="judgment-buttons">
    <view class="judgment-button" bindtap="makeJudgment" data-judgment="H">
      <view class="judgment-title">{{t.judgeA}}</view>
      
    </view>
    
    <view class="judgment-button" bindtap="makeJudgment" data-judgment="M">
      <view class="judgment-title">{{t.judgeB}}</view>
      
    </view>
  </view>
</view> 