<view class="container" hidden="{{!pageReady}}">
  <!-- 顶部导航 -->
  <t-navbar 
    title="{{t.navTitle}}" 
    left-arrow="{{false}}"
    title-color="#1F2937"
    t-class="t-navbar"
    fixed
    placeholder
  >
    <view slot="left" class="custom-back-btn" bindtap="goBack">
      <t-icon name="chevron-left" size="48rpx" color="#1F2937" />
    </view>
  </t-navbar>
  
  <!-- 结果展示 -->
  <view class="result-container mb-large">
    <view class="result-icon {{isCorrect ? 'correct' : 'incorrect'}}">
      <t-icon name="{{isCorrect ? 'check' : 'close'}}" size="96rpx" color="#FFF" />
    </view>
    <view class="result-title">{{isCorrect ? t.correct : t.wrong}}</view>
    <view class="result-desc">
      {{isCorrect ? t.correctDesc1 : t.wrongDesc1}}
      <text class="{{isCorrect ? 'text-success' : 'text-error'}}">{{isCorrect ? '+' + pointsGained : '-' + pointsLost}}</text>{{t.pointsUnit}}{{isCorrect ? t.rewardSuffix : ''}}
    </view>
  </view>
  
  <!-- 对话内容 -->
  <view class="card dialogue-card mb-medium">
    <block wx:for="{{displayMessages}}" wx:key="index">
      <view class="{{item.role === 'A' ? 'message-row' : 'message-row-reverse'}}">
        <view class="avatar-container {{item.role === 'A' ? 'avatar-a' : 'avatar-b'}} {{aiRole === item.role ? 'has-ai-badge' : ''}}">
          <text>{{item.role}}</text>
          <view class="ai-badge" wx:if="{{aiRole === item.role}}">AI</view>
        </view>
        <view class="message-bubble {{item.role === 'A' ? 'message-bubble-a' : 'message-bubble-b'}}">
          <text>{{item.content}}</text>
        </view>
      </view>
    </block>
    <view wx:if="{{messages.length>maxLines}}" class="expand-button" bindtap="toggleExpand">
      <text>{{isExpanded ? t.collapse : t.expand}}</text>
      <t-icon name="{{isExpanded?'chevron-up':'chevron-down'}}" size="32rpx" color="#6B7280" />
    </view>
  </view>
  
  <!-- AI特征解析 -->
  <view class="card ai-analysis-card mb-large" wx:if="{{aiRole !== 'none'}}">
    <view class="analysis-title mb-medium">{{t.aiAnalysis}}</view>
    <view class="analysis-list">
      <view class="analysis-item" wx:for="{{aiFeatures}}" wx:key="index">
        <t-icon name="info-circle" size="40rpx" color="#6366F1" class="analysis-icon" />
        <text class="analysis-text">{{item}}</text>
      </view>
    </view>
  </view>
  
  <!-- 底部按钮 -->
  <image class="next-button" src="/assets/images/result/next_zh.svg" mode="widthFix" hidden="{{currentLang!=='zh'}}" bindtap="nextDialogue" />
  <image class="next-button" src="/assets/images/result/next_en.svg" mode="widthFix" hidden="{{currentLang!=='en'}}" bindtap="nextDialogue" />
  
  <!-- 连击提示 -->
  <view class="combo-notification {{showComboNotification ? 'show' : ''}}" wx:if="{{comboCount > 1}}">
    <text class="iconfont icon-flash_line" style="font-size:40rpx;color:#FFF;"></text>
    <text class="combo-text">{{t.combo}} x{{comboCount}}</text>
  </view>
</view> 